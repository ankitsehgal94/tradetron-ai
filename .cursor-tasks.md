# Tasks for Swing Trade Stock Screener Project

This file outlines a set of tasks for building a fullstack Next.js project for a swing trade stock screener. The app calls an external API to get a list of filtered stocks (e.g., based on RSI < 30, MACD crossover, volume > average), displays results in a table, allows CSV export, embeds TradingView charts with timeframe selection, and manages a watchlist stored in Supabase. The external API is assumed to return JSON array of objects: {symbol, price, rsi, macd, volume, reason}.

Here's an example prompt to use to generate this. Note that you'll first want to either provide a detailed set of notes / prd of exactly what to build, or have a two-step process where you have the AI create the spec, then proceed with this step:
Be sure to use an advanced thinking model with this, ideally "Deep Research" from OpenAI but o1-pro, o3-mini, flash-2-thinking, or (maybe?) DeepSeek R1 could work as well. 

``` txt
Create a very very very detailed markdown checklist of all of the stories for this project plan, with one-story-point tasks (with unchecked checkboxes) that break down each story. It is critically important that all of the details to implement this are in this list. Note that a very competent AI Coding Agent will be using this list to autonomously create this application, so be sure not to miss any details whatsoever, no matter how much time and thinking you must do to complete this very challenging but critically important task.
```

After you generate this task list, here is a prompt to use in cursor agent to kick this off (might be useful to put at the end of your cursorrules file as well?)
Probably helpful to just @include the cursor-tasks.md file as well. 
``` txt
Go through each story and task in the .cursor-tasks.md file. Find the next story to work on. Review each unfinished task, correct any issues or ask for clarifications (only if absolutely needed!). Then proceed to create or edit files to complete each task. After you complete all the tasks in the story, update the file to check off any completed tasks. Run builds and commits after each story. Run all safe commands without asking for approval. Continue with each task until you have finished the story, then stop and wait for me to review.
```

---

## 1. **Project Setup**

1. [ ] **Initialize the Next.js Project**
   - Feel free to skip any of the below if it already exist.
   - Use Create Next App to bootstrap a new project with TypeScript enabled. 
   - Enable the App Router.
   - Install and configure Tailwind CSS for styling.
   - Install Shadcn/UI and initialize it for component library.
   - Set up ESLint and Prettier for code quality.
   - Create a basic folder structure: app/ for pages, components/ for UI, lib/ for utilities, api/ for server actions.

2. [x] **Install Core Dependencies**
   - Install @supabase/supabase-js for Supabase integration.
   - Install papaparse for CSV export functionality.
   - Install react-hot-toast for user notifications (e.g., fetch success/error).
   - Install axios or use fetch for API calls.

3. [x] **Configure Environment Variables**
   - Create .env.local file.
   - Add placeholders for SUPABASE_URL and SUPABASE_ANON_KEY.
   - Add STOCK_API_URL for the external API endpoint (e.g., http://localhost:5000/analyze or cloud URL).
   - Ensure gitignore includes .env.local.

---

## 2. **Supabase Integration**

1. [ ] **Set Up Supabase Project**
   - Create a new Supabase project via dashboard.
   - Set up a 'watchlist' table with columns: id (uuid), user_id (uuid), symbol (text), metrics (jsonb for stored data), created_at (timestamptz).
   - Enable Row Level Security (RLS) on the table: Policy for SELECT/INSERT/UPDATE/DELETE based on auth.uid() = user_id.
   - Enable Realtime on the table for live updates if watchlist changes.
   - Generate and copy SUPABASE_URL and SUPABASE_ANON_KEY to .env.local.

2. [x] **Implement Supabase Client Utilities**
   - Create utils/supabase/client.ts for browser client: Use createClient from @supabase/supabase-js with env vars.
   - Create utils/supabase/server.ts for server-side client: Similar, but with cookie handling for auth.
   - Create utils/supabase/auth.ts with functions for signUp, signIn, signOut, getUser.

3. [ ] **Set Up Basic Authentication**
   - Enable email auth in Supabase dashboard.
   - Create app/auth/page.tsx for login/signup form using Supabase auth functions.
   - Use server actions for form submissions.
   - Implement session management: Use Supabase auth listener in a layout or provider.

---

## 3. **Stock Analysis Logic**

1. [x] **Implement API Fetching Function**
   - Create lib/fetchStocks.ts: Async function to call the external STOCK_API_URL (GET or POST) using fetch or axios.
   - Handle request: If POST, send any params (e.g., filters); await response, parse JSON.
   - Return array of stock objects or throw error if failed.

2. [x] **Create Server Action for Analysis**
   - In app/api/analyze/route.ts (or server action): POST handler to call fetchStocks, return JSON results.
   - Add error handling: API failures, invalid response, timeouts.
   - Cache results for 1 hour using Next.js cache or simple in-memory if local.

---

## 4. **UI Components**

1. [x] **Build Home Page Layout**
   - In app/page.tsx: Render a dashboard layout with header, fetch button, table placeholder, watchlist section.
   - Use Shadcn components: Button for fetch, Table for display, Tabs for switching views (results/watchlist).
   - Add loading spinner (Shadcn Skeleton) during fetches.

2. [x] **Create Stock Table Component**
   - In components/StockTable.tsx: Table with columns: Symbol, Price, RSI, MACD, Volume, Reason, Actions (add to watchlist, view chart).
   - Use Shadcn Table, make sortable by columns (e.g., RSI ascending).
   - Add CSV export button: Use papaparse to generate CSV from data.

3. [x] **Implement Chart Embed**
   - In components/StockChart.tsx: Embed TradingView widget iframe for a symbol.
   - Add dropdown for timeframe (1D, 1W, 1M) using Shadcn Select, update src dynamically.
   - Make modal: Click 'View Chart' in table opens Dialog with embed.

---

## 5. **Fetch Button and Data Display**

1. [x] **Implement Fetch Functionality**
   - In home page: Button triggers server action to fetch from API.
   - Use React Query or useState for managing loading/data/error states.
   - On success: Update table with filtered stocks, show toast notification.

2. [x] **Handle Data Rendering**
   - Pass fetched data to StockTable.
   - If no data: Show message "No stocks match filters" with retry button.
   - Add pagination if results >50 (Shadcn DataTable).

3. [x] **Error Handling in UI**
   - If API error (e.g., fetch failure): Show toast error, suggest retry.
   - Log errors server-side for debugging.

---

## 6. **Export CSV Feature**

1. [x] **Implement Export Logic**
   - In StockTable: Button "Export CSV" calls function to convert data to CSV string using papaparse.
   - Create Blob, use URL.createObjectURL to download as 'stocks.csv'.
   - Include all columns in export.

2. [x] **Customize Export**
   - Allow exporting only selected rows if checkboxes added to table.
   - Add timestamp to filename: 'stocks-YYYY-MM-DD.csv'.

---

## 7. **Watchlist Feature**

1. [x] **Implement Add/Remove to Watchlist**
   - In StockTable rows: Button "Add to Watchlist" calls server action to insert into Supabase (with user_id).
   - Check if already in watchlist: Query first, disable button if exists.
   - Remove button in watchlist view.

2. [x] **Create Watchlist View**
   - In home Tabs: Separate tab fetches watchlist from Supabase on load.
   - Use similar StockTable, but with remove action.
   - Realtime: Subscribe to Supabase changes, update UI live.

3. [x] **Handle Auth for Watchlist**
   - Redirect to login if not authenticated when adding.
   - Fetch watchlist only if user logged in.

---

## 8. **Authentication Enhancements**

1. [ ] **Protect Routes**
   - Use middleware or layout to check session: Redirect unauth users from watchlist actions.
   - Add profile page: Show user email, logout button.

2. [ ] **Improve Auth UI**
   - Use Shadcn forms for login/signup: Email/password, validation.
   - Add forgot password link (Supabase handles).
   - Post-login redirect to home.

3. [ ] **Session Management**
   - Create AuthProvider: Wrap app, provide session context.
   - Auto-refresh tokens using Supabase listener.

---

## 9. **Testing and Documentation**

1. [ ] **Add Unit Tests**
   - Use Jest/Vitest: Test fetchStocks function with mock API responses.
   - Test components: Render StockTable, check rows.

2. [ ] **Manual Testing**
   - Test full flow: Login, fetch (call API), add to watchlist, view chart, export.
   - Edge cases: Empty results, API errors, unauth access.
   - Cross-browser: Chrome, Firefox, mobile responsive.

3. [ ] **Update README and Deploy**
   - README: Setup instructions, env vars (including STOCK_API_URL), run commands, project overview.
   - Deploy to Vercel: Connect GitHub, set env vars, test live.
   - Add CI/CD: GitHub Actions for lint/test on push.